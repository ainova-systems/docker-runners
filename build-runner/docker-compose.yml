# Build Runner - Docker Compose
#
# Local Development:
#   1. Copy .env.example to .env and fill in values
#   2. Run: docker compose up -d --build
#
# Production (use pre-built image):
#   1. Comment out 'build:' section below
#   2. Run: docker compose up -d

services:
  build-runner:
    # Build locally (comment out for production)
    build:
      context: .
      dockerfile: Dockerfile
      args:
        BASE_IMAGE: ${BASE_IMAGE:-ghcr.io/ainova-systems/docker-runners/base-runner:latest}
    # Pre-built image (uncomment for production)
    # image: ghcr.io/ainova-systems/docker-runners/build-runner:latest
    image: build-runner:local
    container_name: ${RUNNER_NAME:-build-runner}
    restart: unless-stopped
    environment:
      - GITHUB_REPOSITORY_URL=${GITHUB_REPOSITORY_URL}
      - GITHUB_RUNNER_TOKEN=${GITHUB_RUNNER_TOKEN}
      - RUNNER_NAME=${RUNNER_NAME:-build-runner}
      - RUNNER_LABELS=${RUNNER_LABELS:-self-hosted,build,dotnet,nodejs}
    volumes:
      # Persist runner configuration
      - runner-data:/home/runner/actions-runner
      # NO Docker socket - this runner doesn't need Docker access

volumes:
  runner-data:
